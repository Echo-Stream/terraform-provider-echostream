---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "echostream_api_authenticator_function Resource - terraform-provider-echostream"
subcategory: ""
description: |-
  ApiAuthenticatorFunctions https://docs.echo.stream/docs/webhook#api-authenticator-function are managed Functions used in API-based Nodes (e.g. - WebhookNode).
---

# echostream_api_authenticator_function (Resource)

[ApiAuthenticatorFunctions](https://docs.echo.stream/docs/webhook#api-authenticator-function) are managed Functions used in API-based Nodes (e.g. - WebhookNode).

## Example Usage

```terraform
resource "echostream_api_authenticator_function" "test" {
  code        = "def authenticator(*, context, request, **kwargs):\n\n    from base64 import b64decode\n    from hashlib import sha256\n    from typing import TYPE_CHECKING, NamedTuple, cast\n\n    from fastapi import HTTPException\n    from starlette.authentication import AuthCredentials, SimpleUser\n\n    class Realm(NamedTuple):\n        name: str\n        users: dict[str, str]\n\n    if TYPE_CHECKING:\n        from echostream_function_context import Context\n        from fastapi import Request\n\n        context = cast(Context, context)\n        request = cast(Request, request)\n\n    if not hasattr(context, \"realms\"):\n        with context:\n            if not hasattr(context, \"realms\"):\n                realms = context.config.get(\"realms\", [])\n                if isinstance(realms, str):\n                    realms = [realms]\n                context.realms = [\n                    Realm(name, context.config.get(name, {})) for name in realms if name\n                ]\n\n    if not (authorization := request.headers.get(\"authorization\")):\n        raise HTTPException(detail=\"Missing Authorization\", status_code=400)\n    try:\n        scheme, user_pass = cast(str, authorization).split()\n        if scheme != \"Basic\":\n            raise ValueError()\n        username, password = b64decode(user_pass).decode().split(\":\")\n    except ValueError as ve:\n        raise HTTPException(detail=\"Invalid Authorization\", status_code=400) from ve\n    pass_hash = sha256(password.encode()).hexdigest()\n    found = False\n    realm: Realm = None\n    for realm in context.realms:\n        if shadow := realm.users.get(username):\n            found = shadow == pass_hash\n            break\n    if not found:\n        raise HTTPException(status_code=403)\n    return AuthCredentials([realm.name]), SimpleUser(username)\n"
  description = "Test authenticator"
  name        = "test"
  readme      = "# basic\n\nPerforms [HTTP Basic Authentication](https://datatracker.ietf.org/doc/html/rfc7617).\n\nThis function expects the authorized usernames and passwords to be in the Node's `config` (this may be either at the Tenant or the Node level) with the following rules:\n\n- The realms that the Node will support, stored at the key `realms`. The value may be either a string (single realm) or a list of strings (multi-realm). For multi-realms, the realms will be searched in order during authentication.\n- For each realm, there must be a key with that realm name. The value at the key must be a dictionary, with the key of the dictionary being the allowed usernames and teh values being the password for the username\n    - Passwords **must** be hashed using SHA256 and stored in a hex digest (no plain text!)\n\nFor example, if we have two realms (\"foo\" and \"bar\"), then the configuration might looks as follows:\n``` json\n{\n    \"foo\": {\n        \"Bob\": \"9dab8c4db500470b4655b8ddf0e947ef8dc8384d74c33e79d05f37aa247463de\",\n        \"Steve\": \"01f540e110f03579d641c620f1e9e2b3b1a8b5cc80b8dada753b35e17247b927\"\n    },\n    \"bar\": {\n        \"Lucy\": \"ed73548f23a08107406c57e4c78c076bc07bd35d93fc144851adc7dcf7090041\",\n        \"Jane\": \"27b34dcc51558774839a52d4dbef630fbda76063ad3911a13165ecd3682eef52\"\n    }\n    \"realms\": [\"foo\", \"bar\"]\n}\n```\n"
  requirements = [
    "fastapi",
    "starlette"
  ]
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `code` (String) The code of the Function in Python string format.
- `description` (String) A human-readable description.
- `name` (String) The Function name. Must be unique within the Tenant.

### Optional

- `readme` (String) README in MarkDown format.
- `requirements` (Set of String) The list of Python requirements, in [pip](https://pip.pypa.io/en/stable/reference/requirement-specifiers/) format.

### Read-Only

- `in_use` (Boolean) True if this is used by other resources.

## Import

Import is supported using the following syntax:

```shell
terraform import echostream_api_authenticator_function.func1 "func_name"
```
